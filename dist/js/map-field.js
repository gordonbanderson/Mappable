var marker,bounds;function gmloaded(){initLivequery()}function initMap(){var a={zoom:16,disableDefaultUI:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDoubleClickZoom:!1,draggable:!0,keyboardShortcuts:!1,scrollwheel:!0};!function(e){var t=e("#GoogleMap"),o=(t.attr("data-latfieldname"),e("input[name="+t.attr("data-latfieldname")+"]")),n=e("input[name="+t.attr("data-lonfieldname")+"]"),r=e("input[name="+t.attr("data-zoomfieldname")+"]"),l=t.attr("data-GuidePoints");""===o.val()&&o.val(0),""===n.val()&&n.val(0),""===r.val()&&r.val(2);var s=[];if(void 0!==l&&(s=JSON.parse(l)),a.center=new google.maps.LatLng(o.val(),n.val()),r.length&&(a.zoom=parseInt(r.val(),10)),map=new google.maps.Map(document.getElementById("GoogleMap"),a),bounds=new google.maps.LatLngBounds,s.length){for(var i=0,g=0,m=s.length-1;m>=0;m--){var d=s[m].latitude,p=s[m].longitude;addGuideMarker(d,p);var c=new google.maps.LatLng(d,p);i+=parseFloat(d),g+=parseFloat(p),bounds.extend(c)}if(0===o.val()&&0===n.val()){var u=s.length;new google.maps.LatLng(i/u,g/u)}map.fitBounds(bounds)}o.val()&&n.val()&&(marker=null,setMarker(a.center,!0)),google.maps.event.addListener(map,"rightclick",function(a){var e=a.latLng.lat(),t=a.latLng.lng();o.val(e),n.val(t),setMarker(a.latLng,!1),statusMessage("Location changed to "+e+","+t)}),google.maps.event.addListener(map,"zoom_changed",function(a){r.length&&r.val(map.getZoom())}),google.maps.event.trigger(map,"resize"),map.setZoom(map.getZoom()),e(".ui-tabs-anchor").click(function(){google.maps.event.trigger(map,"resize"),e("#GoogleMap").attr("data-usemapbounds")?map.fitBounds(bounds):map.setCenter(marker.getPosition())})}(jQuery)}function addGuideMarker(a,e){var t=new google.maps.LatLng(a,e),o=new google.maps.MarkerImage("//chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|CCCCCC",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34)),n=new google.maps.MarkerImage("//chart.apis.google.com/chart?chst=d_map_pin_shadow",new google.maps.Size(40,37),new google.maps.Point(0,0),new google.maps.Point(12,35));new google.maps.Marker({position:t,title:"Marker",icon:o,shadow:n}).setMap(map)}function setMarker(a,e){null!==marker?marker.setPosition(a):((marker=new google.maps.Marker({position:a,title:"Position",draggable:!0})).setMap(map),google.maps.event.addListener(marker,"dragend",setCoordByMarker)),e&&map.setCenter(a)}function setCoordByMarker(a){var e,t,o,n,r,l,s;e=jQuery,t=e("#GoogleMap"),o=e("input[name="+t.attr("data-latfieldname")+"]"),n=e("input[name="+t.attr("data-lonfieldname")+"]"),r=e("input[name="+t.attr("data-zoomfieldname")+"]"),l=a.latLng.lat(),s=a.latLng.lng(),o.val(l),n.val(s),setMarker(a.latLng,!0),statusMessage("Location changed to "+l+","+s),r.length&&r.val(map.getZoom()),map.setCenter(a.latLng)}function searchForAddress(a){!function(e){var t=new google.maps.Geocoder;new google.maps.ElevationService;t&&(statusMessage("Searching for:"+a),t.geocode({address:a},function(a,t){if(t==google.maps.GeocoderStatus.OK){var o=a.length;o>0?statusMessage("Places found"):0===o&&errorMessage("No places found");var n='<ul class="geocodedSearchResults">';e.each(a,function(a,t){var o=[];e.each(t.address_components,function(a,e){o.push(e.long_name)}),n=n+'<li lat="'+t.geometry.location.lat()+'" lon="'+t.geometry.location.lng()+'">'+o+"</li>"}),n+="</ul>",e("#mapSearchResults").html(n)}else errorMessage("Unable to find any geocoded results")}))}(jQuery)}function initLivequery(){var a;(a=jQuery)("input[name=action_GetCoords]").on("click",function(e){var t=a("#Form_EditForm_Location").val();return setCoordByAddress(t),!1}),a("#searchLocationButton").on("click",function(e){return searchForAddress(a("#location_search").val()),!1}),a(".geocodedSearchResults li").on("click",function(e){var t=a(this),o=t.attr("lat"),n=t.attr("lon"),r=t.html(),l=new google.maps.LatLng(o,n);statusMessage("Setting map to "+r),a(".geocodedSearchResults").html(""),a("#Form_EditForm_Latitude").val(o),a("#Form_EditForm_Longitude").val(n);var s=a("#GoogleMap"),i=a("input[name="+s.attr("data-latfieldname")+"]"),g=a("input[name="+s.attr("data-lonfieldname")+"]");return a("input[name="+s.attr("data-zoomfieldname")+"]"),i.val(o),g.val(n),map.setZoom(12),setMarker(l,!0),!1}),a("#GoogleMap").on("match",function(){alert("initalising map"),initMap()}),initMap()}!function(a){jQuery(document).ready(function(){var a;(a=document.createElement("script")).type="text/javascript",a.src="//maps.googleapis.com/maps/api/js?sensor=false&callback=gmloaded&key="+mapsApiKey,document.body.appendChild(a)})}();